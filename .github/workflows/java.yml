name: Build Sikkha48 JAR (J2ME Style)

on:
  push:
    branches:
      - main

jobs:
  build-j2me:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Source Code
        uses: actions/checkout@v4

      - name: Setup Java 8
        uses: actions/setup-java@v4
        with:
          distribution: 'zulu'
          java-version: '8'

      - name: Create Structure and Stub Classes
        run: |
          # ফোল্ডার তৈরি
          mkdir -p src/javax/microedition/midlet
          mkdir -p src/javax/microedition/lcdui
          mkdir -p src/com/sikkha
          mkdir -p res

          # ১. J2ME এর জন্য ডামি ইন্টারফেস তৈরি (যাতে এরর না আসে)
          echo 'package javax.microedition.midlet; public abstract class MIDlet { 
              public abstract void startApp(); 
              public abstract void pauseApp(); 
              public abstract void destroyApp(boolean u); 
              public final void notifyDestroyed() {}
          }' > src/javax/microedition/midlet/MIDlet.java

          echo 'package javax.microedition.lcdui; public class Display { 
              public static Display getDisplay(Object m) { return new Display(); }
              public void setCurrent(Object d) {}
          }' > src/javax/microedition/lcdui/Display.java

          echo 'package javax.microedition.lcdui; public class Form { 
              public Form(String title) {} 
              public void append(String text) {} 
          }' > src/javax/microedition/lcdui/Form.java

          # ২. আপনার মেইন অ্যাপ কোড
          echo 'package com.sikkha;
          import javax.microedition.midlet.*;
          import javax.microedition.lcdui.*;

          public class Sikkha48 extends MIDlet {
              private Display display;
              public Sikkha48() { display = Display.getDisplay(this); }
              public void startApp() {
                  Form f = new Form("Sikkha48 Web");
                  f.append("Sikkha48 Loading...");
                  display.setCurrent(f);
              }
              public void pauseApp() {}
              public void destroyApp(boolean u) {}
          }' > src/com/sikkha/Sikkha48.java

          # ৩. আইকন কপি করা
          if [ -f "assets/icon.png" ]; then
            cp assets/icon.png res/icon.png
          else
            # আইকন না থাকলে একটি ছোট ডামি ফাইল
            printf "\x89PNG\r\n\x1a\n" > res/icon.png
          fi

      - name: Build and Package JAR
        run: |
          mkdir -p bin
          # সব ফাইল একসাথে কম্পাইল করা
          javac -d bin src/javax/microedition/midlet/*.java src/javax/microedition/lcdui/*.java src/com/sikkha/*.java
          
          # ম্যানিফেস্ট তৈরি
          echo "Manifest-Version: 1.0" > manifest.mf
          echo "MIDlet-Name: Sikkha48" >> manifest.mf
          echo "MIDlet-Version: 2.48" >> manifest.mf
          echo "MIDlet-Vendor: Sikkha" >> manifest.mf
          echo "MIDlet-1: Sikkha48, /icon.png, com.sikkha.Sikkha48" >> manifest.mf
          echo "MicroEdition-Profile: MIDP-2.0" >> manifest.mf
          echo "MicroEdition-Configuration: CLDC-1.1" >> manifest.mf
          
          # জার তৈরি (bin এর ভেতর থেকে ক্লাস ফাইল এবং res থেকে আইকন নিয়ে)
          jar cvfm Sikkha48.jar manifest.mf -C bin . -C res .

      - name: Upload Finished JAR
        uses: actions/upload-artifact@v4
        with:
          name: Sikkha48-v2.48-JAR
          path: Sikkha48.jar
